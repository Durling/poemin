<%- include global/header.ejs %>

<%- include global/top.ejs %>
<style>
	.data-poems-list{
		font-size: 1.4rem;
		width: 100%;
		color: #614e3c;
		background: #f6f6f1;
	}
</style>
<link rel="stylesheet" href="">

<div class="data-poems-list col-sm-12">

	<!-- 列表 -->
	<% if(act_status==-1 && rows.length>0){ 
		rows.forEach(function(el){ %>
		<h4 class="text-left">
			<a href="poems?id=<%=el.id%>"><%=el.title%></a>
			<small><%=el.authorName%></small>
		</h4>
		<% })
	}%>

	<!-- 详情 -->
	<% if(act_status==0 && rows.length>0){ 
		rows.forEach(function(el){ %>
		
		<blockquote>
			<h4 class="text-left"><%=el.title%></h4>
			<p class="lead">
				<%-el.content.replace(/\r/ig,'<br/>').replace(/\n/ig,'<br/>')%>
			</p>
			<%if (el.authorName!=''&&el.authorName!=null) {%>
			<footer>
				<%if(el.dynasty!=''&&el.dynasty!=null){%>
				<a href="javascript:;" dynastyId="<%=el.dynastyId%>"><%=el.dynasty%></a>
				<%}%>
				<%if(el.country!=''&&el.country!=null){%>
				<a href="javascript:;" dynastyId="<%=el.dynastyId%>"><%=el.country%></a>
				<%}%>
				<a href="javascript:;" authorId="<%=el.authorId%>"><%=el.authorName%></a>
				
				<cite title="Source Title">
					<%=el.time_place%>
				</cite>
			</footer>
			<%}%>
		</blockquote>
		<ul class="list-unstyled">
			
			<%if (el.translateText!=''&&el.translateText!=null) {%>
			<li data-toggle="collapse" data-target="#translateText" aria-expanded="true" aria-controls="translateText">
				<span class="btn btn-link btn-sm">译文</span>
				<div id="translateText" class="collapse col-sm-12">
					<small><%-el.translateText.replace(/\r/ig,'<br/>').replace(/\n/ig,'<br/>')%></small>
				</div>
			</li>
			<%}%>

			<%if (el.annotation!=''&&el.annotation!=null) {%>
			<li data-toggle="collapse" data-target="#annotation" aria-expanded="true" aria-controls="annotation">
				<span class="btn btn-link btn-sm">注释</span>
				<div id="annotation" class="collapse col-sm-12">
					<small><%-el.annotation.replace(/\r/ig,'<br/>').replace(/\n/ig,'<br/>')%></small>
				</div>
			</li>
			<%}%>

			<%if (el.reference!=''&&el.reference!=null) {%>
			<li data-toggle="collapse" data-target="#reference" aria-expanded="true" aria-controls="reference">
				<span class="btn btn-link btn-sm">参考</span>
				<div id="reference" class="collapse col-sm-12">
					<small><%-el.reference.replace(/\r/ig,'<br/>').replace(/\n/ig,'<br/>')%></small>
				</div>
			</li>
			<%}%>

		</ul>

		<a href="poems?id=<%=el.id%>&act=edit">编辑</a>
		<a href="poems?id=<%=el.id%>&act=comments">评论</a>
		<a href="poems?id=<%=el.id%>&act=handwrite">手写稿</a>
		<a href="poems?id=<%=el.id%>&act=voice">诗之音</a>

		<% })
	 } %>


	<!-- 编辑 -->
	<% if(act_status==1 && rows.length>0){ 
		rows.forEach(function(el){ %>
		<div class="add-new-poem-div">
			<p>
				<input type="text" class="form-control poem-title text-capitalize" placeholder="给你的诗起一个名字" value="<%=el.title%>">
			</p>
			<p>
				<input type="text" class="form-control poem-penName text-capitalize"  placeholder="作者笔名" value="<%=el.authorName%>">
			</p>
			<p>
				<textarea class="form-control poem-content text-capitalize" rows="8" placeholder="诗的正文"><%-el.content%></textarea>
			</p>
			<button class="btn btn-success btn-sm" poemId="<%=el.id%>" act-status="1" onclick="submit_poem_content(this)">提交编辑</button>
		</div>
		<% })
	 } %>


	<!-- 新增 -->
	<% if (act_status==2) { %>
	<div class="add-new-poem-div">
		<p>
			<input type="text" class="form-control poem-title text-capitalize" placeholder="诗的名字">
		</p>
		<p>
			<input type="text" class="form-control poem-penName text-capitalize"  placeholder="作者">
		</p>
		<p>
			<textarea class="form-control poem-content text-capitalize" rows="8" placeholder="诗的正文"></textarea>
		</p>
		<button class="btn btn-success btn-sm" act-status="2" onclick="submit_poem_content(this)">提交新增</button>
	</div>
	<% } %>

	<!--  纠错 -->
	<% if (act_status==3) { %>
	<div class="add-new-poem-div">
		<p>
			<textarea type="text" class="form-control" rows="5"  placeholder="错误内容描述"></textarea>
		</p>
		<p>
			<textarea type="text" class="form-control" rows="5"  placeholder="纠错意见"></textarea>
		</p>
		<p>
			<input type="text" class="form-control" placeholder="参考文献/地址">
		</p>
		<button class="btn btn-success btn-sm" act-status="3" onclick="submit_poem_content(this)">提交纠错</button>
	</div>
	<% } %>


	<!-- 全局 -->
	<p class="bg-info text-center">
		<a href="poems">列表</a>		
		<a href="poems?act=add">增加</a>
		<a href="poems?act=correction">纠错</a>
	</p>
	<p class="bg-success text-center">
		<abbr title="attribute">attr</abbr>
		<abbr title="HyperText Markup Language" class="initialism">HTML</abbr>

		<blockquote>
		  <p>poemin CopyRight</p>
		</blockquote>
	</p>
	
</div>

<script>
	var rows = <%-JSON.stringify(rows)%>;
	var act_status = <%-JSON.stringify(act_status)%>;
</script>

<%- include global/bottom.ejs %>
<script src="js/poems/poem-edit-or-add.js"></script>

<%- include global/footer.ejs %>
